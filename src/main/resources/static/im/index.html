<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JMessage 演示</title>
</head>
<script src="../../static/js/jquery.1.9.1.min.js"></script>
<script src="../../static/js/common.js"></script>
<script src="../../dist/jmessage/jmessage-sdk-web.2.6.0.min.js"></script>
<body>
    <h1>JMessage</h1>

<script>
    var JIM = new JMessage({debug:true});//开启debug模式，若想屏蔽去掉即可

    ajaxGET({},"/im/auth", function (result) {
        JIM.init({
            "appkey" : result.appkey,
            "random_str" : result.random_str,
            "signature" : result.signature,
            "timestamp" : result.timestamp,
            "flag" : 0 //是否启用消息记录漫游，默认 0 否，1 是
        }).onSuccess(function(data) {
            console.log("初始化成功");
            //data.code 返回码
            //data.message 描述
        }).onFail(function(data) {
            // 同上
        });
    });

    JIM.onDisconnect(function(){
        alert("断线处理");
    });



    function register(name, password){
        JIM.register({
            'username' : name,
            'password' : password,
            'is_md5' : false,
            'extras' : {'key1':'val1','key2':'val2'},
            'address' : '深圳'
        }).onSuccess(function(data) {
            //data.code 返回码
            //data.message 描述
        }).onFail(function(data) {
            // 同上
        });
    }

    function login(username, password) {
        JIM.login({
            'username' : username ,
            'password' : password
        }).onSuccess(function(data) {
            //data.code 返回码
            //data.message 描述
            //data.online_list[] 在线设备列表
            //data.online_list[].platform  Android,ios,pc,web
            //data.online_list[].mtime 最近一次登录时间
            //data.online_list[].isOnline 是否在线 true or false
            //data.online_list[].isLogin 是否登录 true or false
            //data.online_list[].flag 该设备是否被当前登录设备踢出 true or false
        }).onFail(function(data){
            //同上
        });
    }
    
    function loginOut() {
        JIM.loginOut();//无回调函数，调用则成功
    }

    /**
     *
     * username	TRUE	用户名
     * appkey	FALSE	跨应用查询时必填，目标应用的 appkey
     * @param username
     * @param appkey
     */
    function getUserInfo(username, appkey) {
        JIM.getUserInfo({
            'username' : username ,
            'appkey' : appkey
        }).onSuccess(function(data) {
            //data.code 返回码
            //data.message 描述
            //data.user_info.username
            //data.user_info.appkey
            //data.user_info.nickname
            //data.user_info.avatar 头像
            //data.user_info.birthday 生日，默认空
            //data.user_info.gender 性别 0 - 未知， 1 - 男 ，2 - 女
            //data.user_info.signature 用户签名
            //data.user_info.region 用户所属地区
            //data.user_info.address 用户地址
            //data.user_info.mtime 用户信息最后修改时间
            //data.extras 自定义json字段
        }).onFail(function(data) {
            //data.code 返回码
            //data.message 描述
        });
    }
    
    function updateSelfInfo() {
        JIM.updateSelfInfo({
            'nickname' : '<your_nickname>',
            'birthday' : '<your_address>',
            'signature' : '<your_address>',
            'gender' : '<your_address>',
            'region' : '<your_address>',
            'address' : '<your_address>',
            'extras' : {'key1':'val1','key2':'val2'}
        }).onSuccess(function(data) {
            //data.code 返回码
            //data.message 描述
        }).onFail(function(data) {
            //同上
        });
    }

    /**
     * 获取会话未读数
     * @param username
     * @returns {*}
     */
    function getUnreadMsgCnt(username) {
        // 单聊，未读数，调用则成功，无回调函数
        var count = JIM.getUnreadMsgCnt({
            'username' : username
        });
        return count;
    }

    /**
     * 重置会话未读数
     * @param username
     */
    function resetUnreadCount(username) {
        // 重置单聊会话，调用则成功，无回调函数
        JIM.resetUnreadCount({
            'username' : username
        });
    }




</script>
</body>
</html>